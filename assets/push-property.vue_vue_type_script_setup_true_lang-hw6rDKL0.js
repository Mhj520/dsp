import{g as z}from"./source-C6q21X3i.js";import{d as X,n as G,db as K,r as U,v as Q,a as r,c,o as p,b as l,u as a,w as s,e as O,F as w,y as D,f as g,h as y,t as W,x as h}from"./index-DsliLC_t.js";const Y={style:{"text-align":"center"}},Z={key:0,style:{lineHeight:"30px"}},oe=X({__name:"push-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(u,{expose:H,emit:F}){const m=u,_=F,x=G(()=>m.type==="publish");let t=K({name:"接口推送数据",datasourceCode:"",datasourceName:null,headers:[{key:"",value:""}],recordExpression:{type:"JSONPATH",expression:""},statusExpression:{type:"JSONPATH",expression:""},successStatus:null,description:null});const P={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0}],"statusExpression.type":[{required:!0,message:"状态判断表达式类型必填"}],"statusExpression.expression":[{required:!0,message:"状态判断表达式必填"}],successStatus:[{required:!0,message:"成功状态值必填"}]};function q(d){t.headers.splice(d,1)}function j(){t.headers.push({key:"",value:""})}const B=()=>{m.lf.setProperties(m.nodeData.id,{...t,headers:R(t.headers)})};function R(d){const e={};return d.forEach(({key:n,value:i})=>{e[n]=i}),e}const A=d=>{d.validateResult===!0&&(B(),_("closed"))},k=U(null);function L(){k.value.submit()}const E=()=>{_("closed")},S=U([]);async function T(){var d;await z({query:{type:"Http",status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(e=>{if(e){const{records:n}=e;S.value=n}}),Object.assign(t,m.nodeData.properties),(d=m.nodeData.properties)!=null&&d.headers&&(t.headers=Object.entries(m.nodeData.properties.headers).map(([e,n])=>({key:e,value:n})))}return Q(()=>{T()}),H({cancelFunc:E,clickFormSubmit:L}),(d,e)=>{const n=r("t-input"),i=r("t-form-item"),b=r("t-option"),C=r("t-select"),v=r("t-divider"),N=r("t-icon"),I=r("t-input-group"),J=r("t-empty"),M=r("t-textarea"),$=r("t-form");return p(),c("div",null,[l($,{ref_key:"form",ref:k,rules:P,data:a(t),colon:!0,onReset:E,onSubmit:A},{default:s(()=>[l(i,{label:"名称",name:"name"},{default:s(()=>[l(n,{modelValue:a(t).name,"onUpdate:modelValue":e[0]||(e[0]=o=>a(t).name=o),readonly:u.type==="publish",placeholder:"请输入节点名称"},null,8,["modelValue","readonly"])]),_:1}),l(i,{label:"数据源",name:"datasourceCode"},{default:s(()=>[l(C,{modelValue:a(t).datasourceCode,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).datasourceCode=o),readonly:u.type==="publish",filterable:"",placeholder:"请选择数据源",style:{width:"100%"}},{default:s(()=>[(p(!0),c(w,null,D(S.value,o=>(p(),g(b,{value:o.code,onClick:V=>a(t).datasourceName=o.name,label:o.name},{default:s(()=>[y(W(o.name),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1}),l(v,null,{default:s(()=>[...e[7]||(e[7]=[y("请求头",-1)])]),_:1}),O("div",Y,[(p(!0),c(w,null,D(a(t).headers,(o,V)=>(p(),g(I,{separate:"",style:{"margin-bottom":"5px"},key:V},{default:s(()=>[l(n,{placeholder:"名称",modelValue:o.key,"onUpdate:modelValue":f=>o.key=f,style:{width:"180px"},readonly:u.type==="publish"},null,8,["modelValue","onUpdate:modelValue","readonly"]),e[9]||(e[9]=O("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}}," - ",-1)),l(n,{placeholder:"值",modelValue:o.value,"onUpdate:modelValue":f=>o.value=f,style:{width:"180px"},readonly:u.type==="publish"},null,8,["modelValue","onUpdate:modelValue","readonly"]),u.type!=="publish"?(p(),c("div",Z,[e[8]||(e[8]=y("   ",-1)),l(N,{loadDefaultIcons:!1,style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle",onClick:f=>q(V)},null,8,["onClick"])])):h("",!0)]),_:2},1024))),128)),a(t).headers.length===0&&u.type==="publish"?(p(),g(J,{key:0})):h("",!0),u.type!=="publish"?(p(),c("div",{key:1,onClick:e[2]||(e[2]=o=>j()),style:{border:"1px dashed var(--td-text-color-placeholder)",height:"25px",color:"var(--td-text-color-secondary)","border-radius":"4px",cursor:"pointer",width:"80%",margin:"10px auto"}},[l(N,{loadDefaultIcons:!1,name:"add-circle"})])):h("",!0)]),l(v,null,{default:s(()=>[...e[10]||(e[10]=[y("响应状态判断",-1)])]),_:1}),l(i,{label:"类型",name:"statusExpression.type"},{default:s(()=>[l(C,{modelValue:a(t).statusExpression.type,"onUpdate:modelValue":e[3]||(e[3]=o=>a(t).statusExpression.type=o),readonly:x.value},{default:s(()=>[l(b,{value:"JSONPATH",label:"路径"}),l(b,{value:"EXPRESSION",label:"表达式"})]),_:1},8,["modelValue","readonly"])]),_:1}),l(i,{label:"表达式",name:"statusExpression.expression"},{default:s(()=>[l(n,{modelValue:a(t).statusExpression.expression,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).statusExpression.expression=o),readonly:x.value,placeholder:"请输入表达式"},null,8,["modelValue","readonly"])]),_:1}),l(i,{label:"比较值",name:"successStatus"},{default:s(()=>[l(n,{modelValue:a(t).successStatus,"onUpdate:modelValue":e[5]||(e[5]=o=>a(t).successStatus=o),readonly:x.value,placeholder:"请输入成功状态值"},null,8,["modelValue","readonly"])]),_:1}),l(v,null,{default:s(()=>[...e[11]||(e[11]=[y("其他配置",-1)])]),_:1}),l(i,{label:"描述",prop:"description"},{default:s(()=>[l(M,{modelValue:a(t).description,"onUpdate:modelValue":e[6]||(e[6]=o=>a(t).description=o),readonly:u.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["data"])])}}});export{oe as _};
