import{d as be,O as ye,l as ge,r as p,v as Se,a as r,c as g,o as u,b as t,w as a,f as d,x as c,u as he,G as Ie,F as U,y as L,e as J,h as S,t as K,M as N,z as Ne,i as Ve}from"./index-DsliLC_t.js";import De from"./index-CFG5K0ca.js";import{a as ke,f as Q,b as Ee,p as we}from"./flow-DPBJZGOq.js";import{g as Ae}from"./list-CIDJ1gXA.js";import"./function-property-CD98HwL7.js";import"./toggleHighContrast-BzokclBc.js";import"./job-CRPoL2MN.js";import"./mysql-9-zCAfVY.js";import"./mysql-qsmisx_v.js";import"./debezium-xGnXjpbG.js";import"./filter-HYrZejpv.js";import"./print-log-Cj0wG1t3.js";import"./split-CI0xwW1S.js";import"./map-DhoY84zN.js";import"./rabbit-xnDxuM-v.js";import"./rabbit-CGDu7EZU.js";import"./rocket-BuA-CRYH.js";import"./rocket-eH4z8zxC.js";import"./doris-D0NRCwdU.js";import"./doris-Dl0ky9cX.js";import"./elastic-Dq8sM_m4.js";import"./kafka-DoHXDx7q.js";import"./kafka-B8XQgmjR.js";import"./oracle-DDZ952iS.js";import"./oracle-CyOaoKYZ.js";import"./push-N__tXhug.js";import"./postgre-CV9kWP2W.js";import"./postgre-CddLE0gC.js";import"./starrocks-DgTZgH-d.js";import"./starrocks-CqMxpPLh.js";import"./dameng-Be-SbGpr.js";import"./dameng-D-nBA8cI.js";import"./function-Bb-V2ugp.js";import"./property-dialog.vue_vue_type_script_setup_true_lang-VezOkjQE.js";import"./bezier.vue_vue_type_script_setup_true_lang-CX9-nprt.js";import"./job-property-Cg_hk46P.js";import"./index-Beb4J_my.js";import"./flow-component-BA4K04df.js";import"./dayjs.min-BC2oYI-_.js";import"./cron-CvQBfdyS.js";import"./index-DsHLwFe9.js";import"./mysql-property-BBx8PwIY.js";import"./source-C6q21X3i.js";import"./mysql-property.vue_vue_type_script_setup_true_lang-3nI6ckP4.js";import"./debezium-property-BB3aVkMa.js";import"./filter-property-ByPEyiiX.js";import"./print-log-property.vue_vue_type_script_setup_true_lang-8ttba4jP.js";import"./split-property.vue_vue_type_script_setup_true_lang-DOxa9JNw.js";import"./map-property.vue_vue_type_script_setup_true_lang-D1pnlz1q.js";import"./rabbit-property.vue_vue_type_script_setup_true_lang-hdAOJhLS.js";import"./rabbit-property.vue_vue_type_script_setup_true_lang-E-MJMUQq.js";import"./rocket-property.vue_vue_type_script_setup_true_lang-Doj679VW.js";import"./rocket-property.vue_vue_type_script_setup_true_lang-Dgr5f97h.js";import"./doris-property-CZrl74Gm.js";import"./doris-property.vue_vue_type_script_setup_true_lang-DHx6bdP_.js";import"./elastic-property.vue_vue_type_script_setup_true_lang-BpgmexDj.js";import"./kafka-property.vue_vue_type_script_setup_true_lang-BcMhlnMw.js";import"./kafka-property.vue_vue_type_script_setup_true_lang-Cvdwm-Kd.js";import"./oracle-property.vue_vue_type_script_setup_true_lang-BIs_XQcW.js";import"./oracle-property-D4zSbxdA.js";import"./push-property.vue_vue_type_script_setup_true_lang-hw6rDKL0.js";import"./postgre-property-BxxHantK.js";import"./postgre-property.vue_vue_type_script_setup_true_lang-CdtRr0-H.js";import"./starrocks-property-BCyuuotJ.js";import"./starrocks-property.vue_vue_type_script_setup_true_lang-DvAfsFAZ.js";import"./dameng-property-BXxUt5_J.js";import"./dameng-property.vue_vue_type_script_setup_true_lang-DWdfmIrt.js";import"./clickhouse-property-BGFs0Eqd.js";import"./rate-limit-property.vue_vue_type_script_setup_true_lang-C2svcgRg.js";import"./sql-server-property-CVZtAgzw.js";import"./sql-server-property.vue_vue_type_script_setup_true_lang-C-hPce7S.js";import"./sap-hana-property-2C3QJzLJ.js";import"./sap-hana-property.vue_vue_type_script_setup_true_lang-Ce6zOdcA.js";import"./sql-script-property-DtamJuRF.js";import"./mongodb-property.vue_vue_type_script_setup_true_lang-hg-wwRgp.js";import"./pull-property-BYLli4IP.js";import"./clickhouse-DwQk4wWl.js";import"./rate-limit-OUYd6bQR.js";import"./sql-server-B90HSwPo.js";import"./sql-server-C_bciPVT.js";import"./sap-hana-DKvmUy7V.js";import"./sap-hana-CDWDZ12z.js";import"./sql-script-X0AJ2fq_.js";import"./mongodb-tF_Cccg6.js";import"./pull-C373L0dd.js";const Re={class:"flow-create"},xe={key:1},Ce={key:2},Fe=2,Ue=2,Le=be({name:"DataFlowCreate",__name:"index",setup(Te){const Z=ye(),T={nodes:[],edges:[]},M={name:[{required:!0,type:"error"}],description:[{required:!0,type:"error"}],status:[{required:!0,type:"error"}],icon:[{required:!0,type:"error"}],code:[{required:!0,type:"error"}],enableAlarm:[{required:!0,type:"error"}],enableMonitor:[{required:!0,type:"error"}],runStrategy:[{required:!0,type:"error"}],instanceNumber:[{required:!0,type:"error"}],specifyInstances:[{required:!0,type:"error"}]},ee=[{value:"FIXED_INSTANCE_NUMBER",label:"固定实例"},{value:"SPECIFY_INSTANCES",label:"指定实例"},{value:"ALL_INSTANCES",label:"全部实例"}],V=[{stem:"logo-adobe-illustrate"},{stem:"logo-apple"},{stem:"logo-adobe-lightroom"},{stem:"logo-chrome"},{stem:"logo-android"},{stem:"logo-codesandbox"},{stem:"logo-gitlab"},{stem:"logo-qq"},{stem:"calculation"},{stem:"chart-line-multi"},{stem:"chart-line-data-1"},{stem:"chart-line-data"},{stem:"chart-pie"},{stem:"object-storage"},{stem:"send"},{stem:"time"}],q={publishDescription:"",checkDataSource:!0},D=ge(),{id:h,step:B}=D.currentRoute.value.query,s=p(B?parseInt(B,10):0),k=p(!1),te=h?Array.isArray(h)?h[0]:h:null,l=p({id:te||null,icon:null,description:null,code:null,name:null,enableAlarm:"ENABLE",enableMonitor:"ENABLE",design:{},runStrategy:"ALL_INSTANCES",instanceNumber:Ue,specifyInstances:[]}),le=()=>{const n=Math.floor(Math.random()*V.length);return V[n].stem};Se(()=>{h?(k.value=!0,ke({id:l.value.id}).then(n=>{n&&(l.value={...n,design:n.design??T,specifyInstances:n.specifyInstances??[]})}).finally(()=>{k.value=!1})):l.value.icon=le()});const O=p(null),P=p(null),E=p(null),w=p([]);function ae(){s.value>0&&(s.value-=1)}function oe(){var n;(n=E.value)==null||n.saveDesign(!0)}async function z(){var n,e,i;if(s.value===0){(n=O.value)==null||n.submit();return}if(s.value===1){if(!await((e=E.value)==null?void 0:e.saveDesign(!1)))return;Ae({serverName:Ne,status:"ONLINE"}).then(v=>{v&&(w.value=v)})}if(s.value===2){(i=P.value)==null||i.submit();return}s.value<Fe&&(s.value+=1)}const ne=n=>{n.validateResult===!0&&Q({id:l.value.id,enableAlarm:l.value.enableAlarm,enableMonitor:l.value.enableMonitor,runStrategy:l.value.runStrategy,instanceNumber:l.value.instanceNumber,specifyInstances:l.value.specifyInstances}).then(e=>{e&&N.success("保存成功")})},re=n=>{if(n.validateResult!==!0)return;const{id:e,icon:i,name:f,description:v}=l.value;e?Q({id:e,icon:i,name:f,description:v}).then(_=>{_&&(s.value=1,N.success("保存成功"))}):Ee(l.value).then(_=>{_&&(N.success("保存成功"),l.value.id=_.id,l.value.code=_.code,l.value.design=_.design??T,s.value=1)})},se=p(V),I=p(!1),A=p(null),R=p(!1),b=p({...q}),ue={publishDescription:[{required:!0,type:"error"}],checkDataSource:[{required:!0,type:"error"}]};function G(){I.value=!1}const ie=n=>{n.validateResult===!0&&(R.value=!0,we({id:l.value.id,...b.value}).then(e=>{e&&(N.success("发布成功"),Z.closeTabRouter(D.currentRoute.value.path),D.push({path:"/data-manage/flow"}))}).finally(()=>{var e;(e=A.value)==null||e.reset(),I.value=!1,R.value=!1}))};function me(){var n;(n=A.value)==null||n.reset(),b.value={...q},I.value=!0}return(n,e)=>{const i=r("t-icon"),f=r("t-col"),v=r("t-step-item"),_=r("t-steps"),x=r("t-row"),X=r("t-card"),Y=r("t-option"),$=r("t-select"),m=r("t-form-item"),j=r("t-input"),H=r("t-textarea"),C=r("t-form"),pe=r("t-loading"),de=r("t-alert"),F=r("t-switch"),ce=r("t-radio"),fe=r("t-radio-group"),ve=r("t-input-number"),W=r("t-button"),_e=r("t-dialog");return u(),g("div",Re,[t(X,{bordered:!1},{default:a(()=>[t(x,{class:"step-header"},{default:a(()=>[t(f,{span:2},{default:a(()=>[s.value!==0?(u(),d(i,{key:0,loadDefaultIcons:!1,name:"chevron-left-circle",class:"step-icon",onClick:ae})):c("",!0)]),_:1}),t(f,{span:8},{default:a(()=>[t(_,{class:"step-container","default-current":0,readonly:"",current:s.value},{default:a(()=>[t(v,{title:"基本信息"}),t(v,{title:"数据流向"}),t(v,{title:"扩展"})]),_:1},8,["current"])]),_:1}),t(f,{span:2,class:"step-actions"},{default:a(()=>[s.value===1?(u(),d(i,{key:0,loadDefaultIcons:!1,name:"save",class:"step-icon",onClick:oe})):c("",!0),s.value===2?(u(),d(i,{key:1,loadDefaultIcons:!1,name:"save",class:"step-icon",onClick:z})):c("",!0),s.value!==2?(u(),d(i,{key:2,loadDefaultIcons:!1,name:"chevron-right-circle",class:"step-icon",onClick:z})):c("",!0),s.value===2&&he(Ie)("data:flow:publish")?(u(),d(i,{key:3,loadDefaultIcons:!1,name:"send",class:"step-icon",onClick:me})):c("",!0)]),_:1})]),_:1})]),_:1}),t(X,{bordered:!1,class:"container-base-margin-top"},{default:a(()=>[s.value===0?(u(),d(x,{key:0},{default:a(()=>[t(f,{span:6,offset:3},{default:a(()=>[t(C,{class:"step-form",data:l.value,ref_key:"baseForm",ref:O,rules:M,"label-align":"right",onSubmit:e[4]||(e[4]=o=>re(o))},{default:a(()=>[t(m,{label:"图标",name:"icon"},{default:a(()=>[t($,{modelValue:l.value.icon,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.icon=o),placeholder:"请选择一个图标",style:{width:"480px"},"popup-props":{overlayInnerStyle:{width:"400px"}}},{valueDisplay:a(()=>[t(i,{loadDefaultIcons:!1,name:l.value.icon,style:{marginRight:"8px"}},null,8,["name"]),S(" "+K(l.value.icon),1)]),default:a(()=>[(u(!0),g(U,null,L(se.value,o=>(u(),d(Y,{key:o.stem,value:o.stem,class:"overlay-options"},{default:a(()=>[J("div",null,[t(i,{loadDefaultIcons:!1,name:o.stem},null,8,["name"])])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l.value.code?(u(),d(m,{key:0,label:"编码",name:"code"},{default:a(()=>[t(j,{style:{width:"480px"},modelValue:l.value.code,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.code=o),class:"form-item-content",type:"search",readonly:""},null,8,["modelValue"])]),_:1})):c("",!0),t(m,{label:"名称",name:"name"},{default:a(()=>[t(j,{style:{width:"480px"},maxlength:200,modelValue:l.value.name,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.name=o),class:"form-item-content",type:"search",placeholder:"请输入数据流名称"},null,8,["modelValue"])]),_:1}),t(m,{label:"描述",name:"description",class:"description-form-item"},{default:a(()=>[t(H,{modelValue:l.value.description,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.description=o),class:"form-item-content",type:"search",maxcharacter:500,placeholder:"请输入数据流描述",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})):c("",!0),s.value===1?(u(),g("div",xe,[t(pe,{showOverlay:!1,loading:k.value,size:"small"},{default:a(()=>[t(De,{ref_key:"design",ref:E,type:"create",flowDetail:l.value},null,8,["flowDetail"])]),_:1},8,["loading"])])):c("",!0),s.value===2?(u(),g("div",Ce,[t(x,null,{default:a(()=>[t(f,{span:6,offset:3},{default:a(()=>[t(C,{class:"step-form",data:l.value,ref_key:"extendForm",ref:P,rules:M,"label-align":"right",onSubmit:e[10]||(e[10]=o=>ne(o))},{default:a(()=>[t(de,{theme:"info"},{message:a(()=>[...e[13]||(e[13]=[S(" 监控关闭后，将不在统计各个组件数据，但会提高数据处理性能。",-1),J("br",null,null,-1),S(" 此页面编辑后请点击保存！ ",-1)])]),_:1}),t(m,{label:"启用监控",name:"enableMonitor",class:"monitor-form-item"},{default:a(()=>[t(F,{modelValue:l.value.enableMonitor,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.enableMonitor=o),customValue:["ENABLE","DISABLE"]},null,8,["modelValue"])]),_:1}),t(m,{label:"启用告警",name:"enableAlarm"},{default:a(()=>[t(F,{modelValue:l.value.enableAlarm,"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.enableAlarm=o),customValue:["ENABLE","DISABLE"]},null,8,["modelValue"])]),_:1}),t(m,{label:"运行策略",name:"runStrategy"},{default:a(()=>[t(fe,{modelValue:l.value.runStrategy,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.runStrategy=o)},{default:a(()=>[(u(),g(U,null,L(ee,o=>t(ce,{key:o.value,value:o.value},{default:a(()=>[S(K(o.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1}),l.value.runStrategy==="SPECIFY_INSTANCES"?(u(),d(m,{key:0,label:"选择实例",name:"specifyInstances"},{default:a(()=>{var o;return[t($,{modelValue:l.value.specifyInstances,"onUpdate:modelValue":e[8]||(e[8]=y=>l.value.specifyInstances=y),multiple:"",placeholder:(o=w.value)!=null&&o.length?"请选择要发布的实例":"暂无运行中的数据流服务"},{default:a(()=>[(u(!0),g(U,null,L(w.value,y=>(u(),d(Y,{key:y.instanceId,value:y.instanceId,label:`${y.instanceId}-${y.cpuUsageRatio}%-${y.memoryUsageRatio}%`},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"])]}),_:1})):c("",!0),l.value.runStrategy==="FIXED_INSTANCE_NUMBER"?(u(),d(m,{key:1,label:"实例数量",name:"instanceNumber"},{default:a(()=>[t(ve,{modelValue:l.value.instanceNumber,"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.instanceNumber=o),min:1,max:100,placeholder:"实例数"},null,8,["modelValue"])]),_:1})):c("",!0)]),_:1},8,["data"])]),_:1})]),_:1})])):c("",!0)]),_:1}),t(_e,{header:"数据流发布",visible:I.value,onClose:G,footer:!1,width:680},{body:a(()=>[t(C,{ref_key:"publishForm",ref:A,data:b.value,rules:ue,"label-width":90,onSubmit:ie},{default:a(()=>[t(m,{label:"校验数据源",name:"checkDataSource"},{default:a(()=>[t(F,{modelValue:b.value.checkDataSource,"onUpdate:modelValue":e[11]||(e[11]=o=>b.value.checkDataSource=o)},null,8,["modelValue"])]),_:1}),t(m,{label:"发布描述",name:"publishDescription"},{default:a(()=>[t(H,{modelValue:b.value.publishDescription,"onUpdate:modelValue":e[12]||(e[12]=o=>b.value.publishDescription=o),class:"form-item-content",type:"text",autosize:{minRows:3,maxRows:6},placeholder:"请输入发布数据流版本描述"},null,8,["modelValue"])]),_:1}),t(m,{style:{float:"right"}},{default:a(()=>[t(W,{variant:"outline",onClick:G},{default:a(()=>[...e[14]||(e[14]=[S("取消",-1)])]),_:1}),t(W,{theme:"primary",loading:R.value,type:"submit"},{default:a(()=>[...e[15]||(e[15]=[S("确定",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}}),fl=Ve(Le,[["__scopeId","data-v-8b570264"]]);export{fl as default};
