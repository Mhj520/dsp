import{d as W,db as X,r as Y,v as Z,a as d,c,o as p,b as a,u as o,w as r,e as y,h as M,f as h,x as g,F as $,y as T,M as j}from"./index-DsliLC_t.js";const ee={key:0,style:{lineHeight:"30px"}},le={style:{"text-align":"center"}},te={key:0,style:{lineHeight:"30px"}},ne=W({__name:"map-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(i,{expose:S,emit:H}){const v=i,x=H;let e=X({name:"数据转换",description:null,retainOriginalField:!1,fieldMapping:[],fieldMappingBatch:"",fieldMappingTab:1,valueMapping:null});const I={name:[{required:!0,message:"名称必填"}],retainOriginalField:[{required:!0}]};function N(n){e.fieldMapping.splice(e.fieldMapping.indexOf(n),1)}function R(n){e.valueMapping.splice(e.valueMapping.indexOf(n),1)}function E(){e.fieldMapping.push({key:"",value:""})}function P(){e.valueMapping.push({key:"",value:""})}function _(n){if(n===1){if(e.fieldMappingBatch)try{e.fieldMapping=V(e.fieldMappingBatch)}catch(l){j.error(l.message),e.fieldMappingTab=2;return}}else n===2&&(e.fieldMappingBatch=k(e.fieldMapping))}function V(n){if(!n)return[];if(n==="->")return[{key:"",value:""}];if(!q(e.fieldMappingBatch))throw new Error("批量映射格式不正确，请检查后重试");return n.split(/\s*,\s*/).map(u=>{const[m,f]=u.split(/\s*->\s*/);return{key:m==null?void 0:m.trim(),value:f==null?void 0:f.trim()}}).filter(u=>u.key&&u.value)}function k(n){return n.map(l=>`${l.key}->${l.value}`).join(`,
`)}function q(n){return/^(\s*[\w\u4e00-\u9fa5]+\s*->\s*[\w\u4e00-\u9fa5]+\s*,)*(\s*[\w\u4e00-\u9fa5]+\s*->\s*[\w\u4e00-\u9fa5]+\s*)$/.test(n)}const L=()=>{let n=[];e.fieldMappingTab===2?e.fieldMappingBatch&&(n=V(e.fieldMappingBatch)):n=e.fieldMapping,v.lf.setProperties(v.nodeData.id,{name:e.name,description:e.description,retainOriginalField:e.retainOriginalField,fieldMapping:n,valueMapping:e.valueMapping,fieldMappingTab:e.fieldMappingTab})},z=n=>{if(n.validateResult===!0){try{L()}catch(l){j.error(l.message);return}x("closed")}},w=Y(null);function A(){w.value.submit()}const B=()=>{x("closed")};async function G(){Object.assign(e,v.nodeData.properties),e.valueMapping=v.nodeData.properties.valueMapping??[],e.fieldMapping?e.fieldMappingTab===2&&(e.fieldMappingBatch=k(e.fieldMapping)):e.fieldMapping=[]}return Z(()=>{G()}),S({cancelFunc:B,clickFormSubmit:A}),(n,l)=>{const u=d("t-input"),m=d("t-form-item"),f=d("t-divider"),J=d("t-switch"),b=d("t-icon"),F=d("t-input-group"),O=d("t-empty"),U=d("t-tab-panel"),C=d("t-textarea"),K=d("t-tabs"),Q=d("t-form");return p(),c("div",null,[a(Q,{ref_key:"form",ref:w,rules:I,data:o(e),colon:!0,onReset:B,onSubmit:z},{default:r(()=>{var D;return[a(m,{label:"名称",name:"name"},{default:r(()=>[a(u,{modelValue:o(e).name,"onUpdate:modelValue":l[0]||(l[0]=t=>o(e).name=t),readonly:i.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),a(f,null,{default:r(()=>[...l[7]||(l[7]=[M("属性映射",-1)])]),_:1}),a(m,{label:"保留原属性",name:"retainOriginalField"},{default:r(()=>[a(J,{modelValue:o(e).retainOriginalField,"onUpdate:modelValue":l[1]||(l[1]=t=>o(e).retainOriginalField=t),"before-change":()=>i.type!=="publish"},null,8,["modelValue","before-change"])]),_:1}),a(K,{"default-value":1,modelValue:o(e).fieldMappingTab,"onUpdate:modelValue":l[4]||(l[4]=t=>o(e).fieldMappingTab=t),onChange:_,style:{"text-align":"center"}},{default:r(()=>[a(U,{value:1,label:"自定义"},{default:r(()=>[l[10]||(l[10]=y("br",null,null,-1)),(p(!0),c($,null,T(o(e).fieldMapping,t=>(p(),h(F,{separate:"",style:{"margin-bottom":"5px"}},{default:r(()=>[a(u,{placeholder:"源属性",modelValue:t.key,"onUpdate:modelValue":s=>t.key=s,style:{width:"178px"},readonly:i.type==="publish"},null,8,["modelValue","onUpdate:modelValue","readonly"]),l[9]||(l[9]=y("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}}," -  ",-1)),a(u,{placeholder:"新属性",modelValue:t.value,"onUpdate:modelValue":s=>t.value=s,style:{width:"178px"},readonly:i.type==="publish"},null,8,["modelValue","onUpdate:modelValue","readonly"]),i.type!=="publish"?(p(),c("div",ee,[l[8]||(l[8]=M("   ",-1)),a(b,{loadDefaultIcons:!1,style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle",onClick:s=>N(t)},null,8,["onClick"])])):g("",!0)]),_:2},1024))),256)),o(e).fieldMapping.length===0&&i.type==="publish"?(p(),h(O,{key:0})):g("",!0),i.type!=="publish"?(p(),c("div",{key:1,onClick:l[2]||(l[2]=t=>E()),style:{border:"1px dashed var(--td-text-color-placeholder)",height:"25px",color:"var(--td-text-color-secondary)","border-radius":"4px",cursor:"pointer",width:"80%",margin:"5px auto"}},[a(b,{loadDefaultIcons:!1,name:"add-circle"})])):g("",!0)]),_:1}),a(U,{value:2,label:"批量"},{default:r(()=>[l[11]||(l[11]=y("br",null,null,-1)),a(C,{modelValue:o(e).fieldMappingBatch,"onUpdate:modelValue":l[3]||(l[3]=t=>o(e).fieldMappingBatch=t),readonly:i.type==="publish",placeholder:"例如：a->a1,b->b1",rows:4},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["modelValue"]),a(f,null,{default:r(()=>[...l[12]||(l[12]=[M("值处理",-1)])]),_:1}),y("div",le,[(p(!0),c($,null,T(o(e).valueMapping,t=>(p(),h(F,{separate:"",style:{"margin-bottom":"5px"}},{default:r(()=>[a(u,{placeholder:"属性",modelValue:t.key,"onUpdate:modelValue":s=>t.key=s,style:{width:"178px"},readonly:i.type==="publish"},null,8,["modelValue","onUpdate:modelValue","readonly"]),l[14]||(l[14]=y("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}}," -  ",-1)),a(u,{placeholder:"文本/表达式(${var > 1})",readonly:i.type==="publish",style:{width:"178px"},modelValue:t.value,"onUpdate:modelValue":s=>t.value=s},null,8,["readonly","modelValue","onUpdate:modelValue"]),i.type!=="publish"?(p(),c("div",te,[l[13]||(l[13]=M("   ",-1)),a(b,{loadDefaultIcons:!1,style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle",onClick:s=>R(t)},null,8,["onClick"])])):g("",!0)]),_:2},1024))),256)),((D=o(e).valueMapping)==null?void 0:D.length)===0&&i.type==="publish"?(p(),h(O,{key:0})):g("",!0),i.type!=="publish"?(p(),c("div",{key:1,onClick:l[5]||(l[5]=t=>P()),style:{border:"1px dashed var(--td-text-color-placeholder)",height:"25px",color:"var(--td-text-color-secondary)","border-radius":"4px",cursor:"pointer",width:"80%",margin:"5px auto"}},[a(b,{loadDefaultIcons:!1,name:"add-circle"})])):g("",!0)]),a(f,null,{default:r(()=>[...l[15]||(l[15]=[M("其他配置",-1)])]),_:1}),a(m,{label:"描述",prop:"description"},{default:r(()=>[a(C,{modelValue:o(e).description,"onUpdate:modelValue":l[6]||(l[6]=t=>o(e).description=t),readonly:i.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]}),_:1},8,["data"])])}}});export{ne as _};
