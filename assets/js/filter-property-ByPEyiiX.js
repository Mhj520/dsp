import{d as z,db as J,r as W,v as X,a as s,c as b,o as p,b as t,u as d,w as o,x as m,h as i,e as A,f as V,F as S,y as g,i as Y}from"./index-DsliLC_t.js";const Z={key:0},ee={key:1,style:{lineHeight:"30px"}},le={key:1,style:{lineHeight:"30px"}},te={key:1,style:{"text-align":"center"}},oe={key:1,style:{lineHeight:"30px"}},ae=z({__name:"filter-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(u,{expose:w,emit:_}){const E=u,C=_;let a=J({name:"数据过滤",description:"",filterType:"STREAM_RECORD",ifEmptyContinue:!1,streamRecord:{schema:null,table:null,operations:[],conditionBefore:[],conditionAfter:[]},plainRecord:{condition:[]}});const B={name:[{required:!0,message:"名称必填"}],filterType:[{required:!0}],ifEmptyContinue:[{required:!0}],operations:[{required:!0}]},M=()=>{E.lf.setProperties(E.nodeData.id,{...a})},G=f=>{var e,y,v;f.validateResult===!0&&((e=a.streamRecord.conditionBefore)==null||e.forEach(r=>{["IS_NULL","IS_NOT_NULL"].includes(r.operator)&&(r.value=null)}),(y=a.streamRecord.conditionAfter)==null||y.forEach(r=>{["IS_NULL","IS_NOT_NULL"].includes(r.operator)&&(r.value=null)}),(v=a.plainRecord.condition)==null||v.forEach(r=>{["IS_NULL","IS_NOT_NULL"].includes(r.operator)&&(r.value=null)}),M(),C("closed"))},k=W(null);function $(){k.value.submit()}const O=()=>{C("closed")};function R(f){f.push({valueType:"STRING",field:"",value:"",operator:"EQ"})}function L(f,e){f.splice(f.indexOf(e),1)}async function P(){Object.assign(a,E.nodeData.properties),a.plainRecord||(a.plainRecord={condition:[]})}X(()=>{P()}),w({cancelFunc:O,clickFormSubmit:$});const F={STRING:[{value:"EQ",label:"等于"},{value:"NE",label:"不等于"},{value:"LIKE",label:"包含"},{value:"IS_NULL",label:"为空"},{value:"IS_NOT_NULL",label:"不为空"}],NUMBER:[{value:"EQ",label:"等于"},{value:"NE",label:"不等于"},{value:"GT",label:"大于"},{value:"LT",label:"小于"},{value:"GE",label:"大于等于"},{value:"LE",label:"小于等于"},{value:"IS_NULL",label:"为空"},{value:"IS_NOT_NULL",label:"不为空"}],DATE:[{value:"EQ",label:"等于"},{value:"NE",label:"不等于"},{value:"GT",label:"大于"},{value:"LT",label:"小于"},{value:"GE",label:"大于等于"},{value:"LE",label:"小于等于"},{value:"IS_NULL",label:"为空"},{value:"IS_NOT_NULL",label:"不为空"}],DATETIME:[{value:"EQ",label:"等于"},{value:"NE",label:"不等于"},{value:"GT",label:"大于"},{value:"LT",label:"小于"},{value:"GE",label:"大于等于"},{value:"LE",label:"小于等于"},{value:"IS_NULL",label:"为空"},{value:"IS_NOT_NULL",label:"不为空"}]};function N(f){return F[f]||[]}function I(f){f.operator=null,f.value=null}return(f,e)=>{const y=s("t-input"),v=s("t-form-item"),r=s("t-option"),T=s("t-select"),Q=s("t-switch"),U=s("t-icon"),j=s("t-popup"),D=s("t-divider"),c=s("t-input-group"),x=s("t-empty"),h=s("t-tab-panel"),q=s("t-tabs"),H=s("t-textarea"),K=s("t-form");return p(),b("div",null,[t(K,{ref_key:"form",ref:k,rules:B,data:d(a),colon:!0,onReset:O,onSubmit:G},{default:o(()=>[t(v,{label:"名称",name:"name"},{default:o(()=>[t(y,{modelValue:d(a).name,"onUpdate:modelValue":e[0]||(e[0]=l=>d(a).name=l),readonly:u.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),t(v,{label:"过滤类型",name:"filterType"},{default:o(()=>[t(T,{modelValue:d(a).filterType,"onUpdate:modelValue":e[1]||(e[1]=l=>d(a).filterType=l),readonly:u.type==="publish",placeholder:"请选择过滤类型",style:{width:"100%"}},{default:o(()=>[t(r,{value:"STREAM_RECORD",label:"实时数据"},{default:o(()=>[...e[10]||(e[10]=[i("实时数据",-1)])]),_:1}),t(r,{value:"PLAIN_RECORD",label:"普通数据"},{default:o(()=>[...e[11]||(e[11]=[i("普通数据",-1)])]),_:1})]),_:1},8,["modelValue","readonly"])]),_:1}),t(v,{label:"为空继续",name:"ifEmptyContinue"},{default:o(()=>[t(Q,{modelValue:d(a).ifEmptyContinue,"onUpdate:modelValue":e[2]||(e[2]=l=>d(a).ifEmptyContinue=l),"before-change":()=>u.type!=="publish"},null,8,["modelValue","before-change"]),e[12]||(e[12]=i("   ",-1)),t(j,{content:"过滤结果为空是否继续执行后续组件"},{default:o(()=>[t(U,{loadDefaultIcons:!1,name:"help-circle"})]),_:1})]),_:1}),t(D,null,{default:o(()=>[...e[13]||(e[13]=[i("过滤条件",-1)])]),_:1}),d(a).filterType==="STREAM_RECORD"?(p(),b("div",Z,[t(v,{label:"库",name:"streamSchema"},{default:o(()=>[t(y,{modelValue:d(a).streamRecord.schema,"onUpdate:modelValue":e[3]||(e[3]=l=>d(a).streamRecord.schema=l),readonly:u.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),t(v,{label:"表",name:"streamTable"},{default:o(()=>[t(y,{modelValue:d(a).streamRecord.table,"onUpdate:modelValue":e[4]||(e[4]=l=>d(a).streamRecord.table=l),readonly:u.type==="publish",placeholder:"请输入过滤的表，支持正则表达式"},null,8,["modelValue","readonly"])]),_:1}),t(v,{label:"操作类型",name:"streamOperations"},{default:o(()=>[t(T,{multiple:"",modelValue:d(a).streamRecord.operations,"onUpdate:modelValue":e[5]||(e[5]=l=>d(a).streamRecord.operations=l),readonly:u.type==="publish",placeholder:"请选择操作类型",style:{width:"100%"}},{default:o(()=>[t(r,{value:"INSERT",label:"新增"},{default:o(()=>[...e[14]||(e[14]=[i("新增",-1)])]),_:1}),t(r,{value:"UPDATE",label:"更新"},{default:o(()=>[...e[15]||(e[15]=[i("更新",-1)])]),_:1}),t(r,{value:"DELETE",label:"删除"},{default:o(()=>[...e[16]||(e[16]=[i("删除",-1)])]),_:1})]),_:1},8,["modelValue","readonly"])]),_:1}),t(q,{"default-value":2,style:{"text-align":"center"}},{default:o(()=>[t(h,{value:1,label:"变更前"},{default:o(()=>[e[22]||(e[22]=A("br",null,null,-1)),(p(!0),b(S,null,g(d(a).streamRecord.conditionBefore,l=>(p(),V(c,{separate:"",style:{"margin-bottom":"5px",float:"left"}},{default:o(()=>[t(T,{placeholder:"类型",modelValue:l.valueType,"onUpdate:modelValue":n=>l.valueType=n,readonly:u.type==="publish",onChange:n=>I(l),style:{width:"90px"}},{default:o(()=>[t(r,{value:"STRING",label:"字符串"},{default:o(()=>[...e[17]||(e[17]=[i("字符串",-1)])]),_:1}),t(r,{value:"NUMBER",label:"数值"},{default:o(()=>[...e[18]||(e[18]=[i("数值",-1)])]),_:1}),t(r,{value:"DATE",label:"日期"},{default:o(()=>[...e[19]||(e[19]=[i("日期",-1)])]),_:1}),t(r,{value:"DATETIME",label:"日期时间"},{default:o(()=>[...e[20]||(e[20]=[i("日期时间",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","readonly","onChange"]),t(y,{modelValue:l.field,"onUpdate:modelValue":n=>l.field=n,style:{width:"95px","margin-left":"2px"},readonly:u.type==="publish",placeholder:"属性"},null,8,["modelValue","onUpdate:modelValue","readonly"]),t(T,{readonly:u.type==="publish",placeholder:"运算符",modelValue:l.operator,"onUpdate:modelValue":n=>l.operator=n,style:{width:"90px"},options:N(l.valueType)},null,8,["readonly","modelValue","onUpdate:modelValue","options"]),["IS_NULL","IS_NOT_NULL"].includes(l.operator)?m("",!0):(p(),V(y,{key:0,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,style:{width:"95px","margin-left":"2px"},placeholder:"值"},null,8,["modelValue","onUpdate:modelValue"])),u.type!=="publish"?(p(),b("div",ee,[e[21]||(e[21]=i("   ",-1)),t(U,{loadDefaultIcons:!1,onClick:n=>L(d(a).streamRecord.conditionBefore,l),style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle"},null,8,["onClick"])])):m("",!0)]),_:2},1024))),256)),d(a).streamRecord.conditionBefore.length===0&&u.type==="publish"?(p(),V(x,{key:0})):m("",!0),u.type!=="publish"?(p(),b("div",{key:1,onClick:e[6]||(e[6]=l=>R(d(a).streamRecord.conditionBefore)),class:"add-condition-button"},[t(U,{loadDefaultIcons:!1,name:"add-circle"})])):m("",!0)]),_:1}),t(h,{value:2,label:"变更后"},{default:o(()=>[e[28]||(e[28]=A("br",null,null,-1)),(p(!0),b(S,null,g(d(a).streamRecord.conditionAfter,l=>(p(),V(c,{separate:"",style:{"margin-bottom":"5px",float:"left"}},{default:o(()=>[t(T,{placeholder:"类型",modelValue:l.valueType,"onUpdate:modelValue":n=>l.valueType=n,readonly:u.type==="publish",onChange:n=>I(l),style:{width:"90px"}},{default:o(()=>[t(r,{value:"STRING",label:"字符串"},{default:o(()=>[...e[23]||(e[23]=[i("字符串",-1)])]),_:1}),t(r,{value:"NUMBER",label:"数值"},{default:o(()=>[...e[24]||(e[24]=[i("数值",-1)])]),_:1}),t(r,{value:"DATE",label:"日期"},{default:o(()=>[...e[25]||(e[25]=[i("日期",-1)])]),_:1}),t(r,{value:"DATETIME",label:"日期时间"},{default:o(()=>[...e[26]||(e[26]=[i("日期时间",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","readonly","onChange"]),t(y,{modelValue:l.field,"onUpdate:modelValue":n=>l.field=n,style:{width:"95px","margin-left":"2px"},readonly:u.type==="publish",placeholder:"属性"},null,8,["modelValue","onUpdate:modelValue","readonly"]),t(T,{readonly:u.type==="publish",placeholder:"运算符",modelValue:l.operator,"onUpdate:modelValue":n=>l.operator=n,style:{width:"90px"},options:N(l.valueType)},null,8,["readonly","modelValue","onUpdate:modelValue","options"]),["IS_NULL","IS_NOT_NULL"].includes(l.operator)?m("",!0):(p(),V(y,{key:0,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,style:{width:"95px","margin-left":"2px"},readonly:u.type==="publish",placeholder:"值"},null,8,["modelValue","onUpdate:modelValue","readonly"])),u.type!=="publish"?(p(),b("div",le,[e[27]||(e[27]=i("   ",-1)),t(U,{loadDefaultIcons:!1,onClick:n=>L(d(a).streamRecord.conditionAfter,l),style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle"},null,8,["onClick"])])):m("",!0)]),_:2},1024))),256)),d(a).streamRecord.conditionAfter.length===0&&u.type==="publish"?(p(),V(x,{key:0})):m("",!0),u.type!=="publish"?(p(),b("div",{key:1,onClick:e[7]||(e[7]=l=>R(d(a).streamRecord.conditionAfter)),class:"add-condition-button"},[t(U,{loadDefaultIcons:!1,name:"add-circle"})])):m("",!0)]),_:1})]),_:1})])):d(a).filterType==="PLAIN_RECORD"?(p(),b("div",te,[(p(!0),b(S,null,g(d(a).plainRecord.condition,l=>(p(),V(c,{separate:"",style:{"margin-bottom":"5px"}},{default:o(()=>[t(T,{placeholder:"类型",modelValue:l.valueType,"onUpdate:modelValue":n=>l.valueType=n,onChange:n=>I(l),readonly:u.type==="publish",style:{width:"84px"}},{default:o(()=>[t(r,{value:"STRING",label:"字符串"},{default:o(()=>[...e[29]||(e[29]=[i("字符串",-1)])]),_:1}),t(r,{value:"NUMBER",label:"数值"},{default:o(()=>[...e[30]||(e[30]=[i("数值",-1)])]),_:1}),t(r,{value:"DATE",label:"日期"},{default:o(()=>[...e[31]||(e[31]=[i("日期",-1)])]),_:1}),t(r,{value:"DATETIME",label:"日期时间"},{default:o(()=>[...e[32]||(e[32]=[i("日期时间",-1)])]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","onChange","readonly"]),t(y,{modelValue:l.field,"onUpdate:modelValue":n=>l.field=n,style:{width:"95px","margin-left":"2px"},readonly:u.type==="publish",placeholder:"属性"},null,8,["modelValue","onUpdate:modelValue","readonly"]),t(T,{readonly:u.type==="publish",placeholder:"运算符",modelValue:l.operator,"onUpdate:modelValue":n=>l.operator=n,style:{width:"90px"},options:N(l.valueType)},null,8,["readonly","modelValue","onUpdate:modelValue","options"]),["IS_NULL","IS_NOT_NULL"].includes(l.operator)?m("",!0):(p(),V(y,{key:0,modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,style:{width:"95px","margin-left":"2px"},readonly:u.type==="publish",placeholder:"值"},null,8,["modelValue","onUpdate:modelValue","readonly"])),u.type!=="publish"?(p(),b("div",oe,[e[33]||(e[33]=i("   ",-1)),t(U,{loadDefaultIcons:!1,onClick:n=>L(d(a).plainRecord.condition,l),style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle"},null,8,["onClick"])])):m("",!0)]),_:2},1024))),256)),d(a).plainRecord.condition.length===0&&u.type==="publish"?(p(),V(x,{key:0})):m("",!0),u.type!=="publish"?(p(),b("div",{key:1,onClick:e[8]||(e[8]=l=>R(d(a).plainRecord.condition)),class:"add-condition-button"},[t(U,{name:"add-circle",loadDefaultIcons:!1})])):m("",!0)])):m("",!0),t(D,null,{default:o(()=>[...e[34]||(e[34]=[i("其他配置",-1)])]),_:1}),t(v,{label:"描述",prop:"description"},{default:o(()=>[t(H,{modelValue:d(a).description,"onUpdate:modelValue":e[9]||(e[9]=l=>d(a).description=l),readonly:u.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["data"])])}}}),de=Y(ae,[["__scopeId","data-v-21435bef"]]);export{de as default};
