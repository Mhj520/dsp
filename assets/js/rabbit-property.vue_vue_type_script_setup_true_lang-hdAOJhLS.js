import{g as j}from"./source-C6q21X3i.js";import{d as B,db as L,r as g,v as M,a as r,c as v,o as c,b as o,u as l,w as n,F as Q,y as P,f as A,h as p,t as I}from"./index-DsliLC_t.js";const H=B({__name:"rabbit-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(u,{expose:S,emit:x}){const m=u,f=x;let t=L({name:"RabbitMQ消息发送",description:"",queue:"",exchange:"",datasourceCode:null,datasourceName:null,batchSplitSize:100});const h={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0,message:"数据源必填"}],batchSplitSize:[{required:!0}],queue:[{validator:b}],exchange:[{validator:b}]};function b(s){const{queue:e,exchange:i}=t;return!e&&!i?{result:!1,message:"队列或交换机不能同时为空"}:{result:!0}}const q=()=>{m.lf.setProperties(m.nodeData.id,{...t})},C=s=>{s.validateResult===!0&&(q(),f("closed"))},y=g(null);function k(){y.value.submit()}const _=()=>{f("closed")},V=g([]);async function F(){await j({query:{type:"RabbitMQ",status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(s=>{const{records:e}=s;V.value=e}),Object.assign(t,m.nodeData.properties)}return M(()=>{F()}),S({cancelFunc:_,clickFormSubmit:k}),(s,e)=>{const i=r("t-input"),d=r("t-form-item"),U=r("t-option"),w=r("t-select"),z=r("t-input-number"),D=r("t-icon"),O=r("t-popup"),R=r("t-divider"),E=r("t-textarea"),N=r("t-form");return c(),v("div",null,[o(N,{ref_key:"form",ref:y,rules:h,data:l(t),colon:!0,onReset:_,onSubmit:C},{default:n(()=>[o(d,{label:"名称",name:"name"},{default:n(()=>[o(i,{modelValue:l(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(t).name=a),readonly:u.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),o(d,{label:"数据源",name:"datasourceCode"},{default:n(()=>[o(w,{readonly:u.type==="publish",filterable:"",modelValue:l(t).datasourceCode,"onUpdate:modelValue":e[1]||(e[1]=a=>l(t).datasourceCode=a),placeholder:"请选择数据源",style:{width:"100%"}},{default:n(()=>[(c(!0),v(Q,null,P(V.value,a=>(c(),A(U,{value:a.code,onClick:T=>l(t).datasourceName=a.name,label:a.name},{default:n(()=>[p(I(a.name),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["readonly","modelValue"])]),_:1}),o(d,{label:"交换机",name:"exchange","required-mark":""},{default:n(()=>[o(i,{modelValue:l(t).exchange,"onUpdate:modelValue":e[2]||(e[2]=a=>l(t).exchange=a),readonly:u.type==="publish",placeholder:"交换机（队列为空时必填）"},null,8,["modelValue","readonly"])]),_:1}),o(d,{label:"队列",name:"queue","required-mark":""},{default:n(()=>[o(i,{modelValue:l(t).queue,"onUpdate:modelValue":e[3]||(e[3]=a=>l(t).queue=a),readonly:u.type==="publish",placeholder:"队列名或路由键（交换机为空时必填）"},null,8,["modelValue","readonly"])]),_:1}),o(d,{label:"数据切片",name:"batchSplitSize"},{default:n(()=>[o(z,{modelValue:l(t).batchSplitSize,"onUpdate:modelValue":e[4]||(e[4]=a=>l(t).batchSplitSize=a),min:1,max:1e3,readonly:u.type==="publish",placeholder:"请输入"},null,8,["modelValue","readonly"]),e[6]||(e[6]=p("   ",-1)),o(O,{content:"对数据进行切割指定数量后分批发送，防止单个消息过长影响性能"},{default:n(()=>[o(D,{loadDefaultIcons:!1,name:"help-circle"})]),_:1})]),_:1}),o(R,null,{default:n(()=>[...e[7]||(e[7]=[p("其他配置",-1)])]),_:1}),o(d,{label:"描述",prop:"description"},{default:n(()=>[o(E,{modelValue:l(t).description,"onUpdate:modelValue":e[5]||(e[5]=a=>l(t).description=a),readonly:u.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["data"])])}}});export{H as _};
