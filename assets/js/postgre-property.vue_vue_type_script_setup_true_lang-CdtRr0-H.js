import{l as ae,g as le}from"./source-C6q21X3i.js";import{d as oe,db as ne,r as f,L as re,N as b,v as ue,a as u,c as S,o as p,b as o,u as l,w as n,f as V,x as D,F as B,y as K,h as _,t as j,e as y}from"./index-DsliLC_t.js";import{e as w}from"./toggleHighContrast-BzokclBc.js";const se={key:2},pe=oe({__name:"postgre-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(m,{expose:z,emit:A}){const g=m,N=A;let t=ne({name:"PostgreSQL数据写入",description:"",customSQL:{enable:!1,mapping:{DELETE:"",UPDATE:"",INSERT:""}},datasourceCode:"",datasourceName:"",schemaCode:"",schemaName:"",tableCode:"",primaryKey:[]});const I={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0,message:"数据源必选"}],schemaCode:[{required:!0,message:"数据库必选"}],tableCode:[{required:!0,message:"表必选"}],primaryKey:[{required:!0,message:"主键列必填"}]},Q=f([]),x=f([]);function T(r){t.datasourceName=r.name,ae({id:r.id}).then(e=>{e&&(x.value=e,e.forEach(v=>{if(g.nodeData.properties.schemaCode===v.key){U(v);return}}))})}function U(r){t.schemaName=r.label}const $=()=>{g.lf.setProperties(g.nodeData.id,{...t})},G=r=>{r.validateResult===!0&&($(),N("closed"))},q=f(null);function H(){q.value.submit()}const O=()=>{N("closed")};async function J(){await le({query:{type:"PostgreSQL",status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(r=>{Q.value=r.records,r.records.forEach(e=>{if(g.nodeData.properties.datasourceCode===e.code){T(e);return}})}),Object.assign(t,g.nodeData.properties)}const C=f(null),h=f(null),E=f(null);let s,d,i;const L=()=>{C.value&&!s&&(s=w.create(C.value,{value:t.customSQL.mapping.DELETE,language:"sql",theme:b(),placeholder:"delete from table where id = :id",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),s.onDidChangeModelContent(()=>{t.customSQL.mapping.DELETE=s.getValue()})),h.value&&!d&&(d=w.create(h.value,{value:t.customSQL.mapping.UPDATE,language:"sql",theme:b(),placeholder:"update table set name = 'test' where id = :id",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),d.onDidChangeModelContent(()=>{t.customSQL.mapping.UPDATE=d.getValue()})),E.value&&!i&&(i=w.create(E.value,{value:t.customSQL.mapping.INSERT,language:"sql",theme:b(),placeholder:"insert into table (id, name) values (:id, :name)",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),i.onDidChangeModelContent(()=>{t.customSQL.mapping.INSERT=i.getValue()}))};return re(()=>{if(C.value){L();const r=b();s&&s.updateOptions({theme:r})}else s&&(s.dispose(),s=null);if(h.value){L();const r=b();d&&d.updateOptions({theme:r})}else d&&(d.dispose(),d=null);if(E.value){L();const r=b();i&&i.updateOptions({theme:r})}else i&&(i.dispose(),i=null)}),ue(()=>{J()}),z({cancelFunc:O,clickFormSubmit:H}),(r,e)=>{const v=u("t-input"),c=u("t-form-item"),F=u("t-option"),P=u("t-select"),W=u("t-tag-input"),X=u("t-switch"),R=u("t-divider"),k=u("t-tab-panel"),Y=u("t-tabs"),Z=u("t-textarea"),ee=u("t-form");return p(),S("div",null,[o(ee,{ref_key:"form",ref:q,rules:I,data:l(t),colon:!0,onReset:O,onSubmit:G},{default:n(()=>{var M;return[o(c,{label:"名称",name:"name"},{default:n(()=>[o(v,{modelValue:l(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(t).name=a),readonly:m.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),o(c,{label:"数据源",name:"datasourceCode"},{default:n(()=>[o(P,{modelValue:l(t).datasourceCode,"onUpdate:modelValue":e[1]||(e[1]=a=>l(t).datasourceCode=a),onChange:e[2]||(e[2]=()=>{l(t).schemaCode=null,l(t).schemaName=null,l(t).tableCode=null}),readonly:m.type==="publish",filterable:"",placeholder:"请选择数据源",style:{width:"100%"}},{default:n(()=>[(p(!0),S(B,null,K(Q.value,a=>(p(),V(F,{value:a.code,onClick:te=>T(a),label:a.name},{default:n(()=>[_(j(a.name),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1}),l(t).datasourceCode?(p(),V(c,{key:0,label:"库",name:"schemaCode"},{default:n(()=>[o(P,{modelValue:l(t).schemaCode,"onUpdate:modelValue":e[3]||(e[3]=a=>l(t).schemaCode=a),readonly:m.type==="publish",placeholder:"请选择数据库",style:{width:"100%"}},{default:n(()=>[(p(!0),S(B,null,K(x.value,a=>(p(),V(F,{value:a.key,onClick:te=>U(a),label:a.label},{default:n(()=>[_(j(a.label),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1})):D("",!0),l(t).schemaCode?(p(),V(c,{key:1,label:"表",name:"tableCode"},{default:n(()=>[o(v,{modelValue:l(t).tableCode,"onUpdate:modelValue":e[4]||(e[4]=a=>l(t).tableCode=a),readonly:m.type==="publish",placeholder:"请输入写入的表，支持分表"},null,8,["modelValue","readonly"])]),_:1})):D("",!0),o(c,{label:"主键列",name:"primaryKey"},{default:n(()=>[o(W,{modelValue:l(t).primaryKey,"onUpdate:modelValue":e[5]||(e[5]=a=>l(t).primaryKey=a),readonly:m.type==="publish","excess-tags-display-type":"break-line",placeholder:"请输入主键列，回车确认",clearable:""},null,8,["modelValue","readonly"])]),_:1}),o(c,{label:"自定义脚本",name:"customSQL"},{default:n(()=>[o(X,{modelValue:l(t).customSQL.enable,"onUpdate:modelValue":e[6]||(e[6]=a=>l(t).customSQL.enable=a),"before-change":()=>m.type!=="publish"},null,8,["modelValue","before-change"])]),_:1}),(M=l(t).customSQL)!=null&&M.enable?(p(),S("div",se,[o(R,null,{default:n(()=>[...e[8]||(e[8]=[_("自定义脚本",-1)])]),_:1}),o(Y,{"default-value":1},{default:n(()=>[o(k,{value:1,label:"删除"},{default:n(()=>[e[9]||(e[9]=y("br",null,null,-1)),y("div",{ref_key:"deleteEditorContainer",ref:C,style:{height:"150px",width:"100%"}},null,512)]),_:1}),o(k,{value:2,label:"更新"},{default:n(()=>[e[10]||(e[10]=y("br",null,null,-1)),y("div",{ref_key:"updateEditorContainer",ref:h,style:{height:"150px",width:"100%"}},null,512)]),_:1}),o(k,{value:3,label:"插入"},{default:n(()=>[e[11]||(e[11]=y("br",null,null,-1)),y("div",{ref_key:"insertEditorContainer",ref:E,style:{height:"150px",width:"100%"}},null,512)]),_:1})]),_:1})])):D("",!0),o(R,null,{default:n(()=>[...e[12]||(e[12]=[_("其他配置",-1)])]),_:1}),o(c,{label:"描述",prop:"description"},{default:n(()=>[o(Z,{modelValue:l(t).description,"onUpdate:modelValue":e[7]||(e[7]=a=>l(t).description=a),readonly:m.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]}),_:1},8,["data"])])}}});export{pe as _};
