import{g as ie}from"./source-C6q21X3i.js";import{e as pe}from"./toggleHighContrast-BzokclBc.js";import{d as me,r as E,n as F,db as ye,L as ce,N as I,v as fe,a as m,c as f,o as s,b as l,w as a,e as v,f as k,x as b,F as U,y as C,h as y,t as xe,i as ve}from"./index-DsliLC_t.js";const be={style:{"margin-top":"-15px"}},Ve={style:{"text-align":"center"}},ge={key:0,style:{lineHeight:"30px"}},he={key:1,style:{"text-align":"center"}},ke={key:0,style:{lineHeight:"30px"}},Se={style:{"text-align":"center"}},Te={style:{"line-height":"30px"}},Oe={key:0,style:{lineHeight:"30px"}},_e=me({__name:"pull-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},emits:["closed"],setup(V,{expose:L,emit:R}){const g=V,O=R,P=E(1),r=F(()=>g.type==="publish");async function j(n){n===2?O("changeDrawerSize",600):O("resetDrawerSize")}const t=ye({name:"接口拉取数据",datasourceCode:"",datasourceName:null,method:"POST",contentType:"JSON",bodyJson:"",formBody:[{key:"",value:""}],headers:[{key:"",value:""}],recordExpression:{type:"JSONPATH",expression:""},statusExpression:{type:"JSONPATH",expression:""},successStatus:"",loopPull:!1,maxLoopCount:1e3,variables:[{variableType:"l",key:"",expressionType:"JSONPATH",expression:"",required:!1}],description:null}),M={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0,message:"数据源必选"}],method:[{required:!0,message:"请求方式必选"}],contentType:[{required:!0,message:"Content-Type 必选"}],bodyJson:[{required:F(()=>t.contentType==="JSON").value,message:"请求体必填"}],"recordExpression.type":[{required:!0,message:"记录提取表达式类型必填"}],"statusExpression.type":[{required:!0,message:"状态判断表达式类型必填"}],"statusExpression.expression":[{required:!0,message:"状态判断表达式必填"}],successStatus:[{required:!0,message:"成功状态值必填"}],loopPull:[{required:!0,message:"是否启用循环必填"}],maxLoopCount:[{required:!0,message:"最大循环次数必填"}]},_=E(null);let c=null;ce(()=>{t.contentType==="JSON"&&(_.value?(z(),c==null||c.updateOptions({theme:I()})):c&&(c.dispose(),c=null))});function z(){c||!_.value||(c=pe.create(_.value,{value:t.bodyJson,placeholder:`{
      "page": "\${page}",
      "size": "\${size}"
}`,language:"json",theme:I(),minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),c.onDidChangeModelContent(()=>{t.bodyJson=(c==null?void 0:c.getValue())||""}))}function A(){t.formBody.push({key:"",value:""})}function X(n){t.formBody.splice(n,1)}function $(n){t.headers.splice(n,1)}function G(){t.headers.push({key:"",value:""})}function W(){t.variables.push({variableType:"l",key:"",expressionType:"JSONPATH",expression:"",required:!1})}function K(n){t.variables.splice(n,1)}function Q(n){const e={};return n.forEach(({key:p,value:u})=>{e[p]=u}),e}const Y=()=>{const n={...t,headers:Q(t.headers),variables:t.variables};t.contentType==="JSON"?n.body=t.bodyJson:n.body=JSON.stringify(Z(t.formBody)),g.lf.setProperties(g.nodeData.id,n)};function Z(n){const e={};return n.forEach(({key:p,value:u})=>{p&&(e[p]=u)}),e}const J=E();function ee(){var n;(n=J.value)==null||n.submit()}const le=n=>{n.validateResult===!0&&(Y(),O("closed"))},D=()=>O("closed"),H=E([]);async function te(){var n,e,p,u;if(await ie({query:{type:"Http",status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(d=>{d&&(H.value=d.records)}),Object.assign(t,g.nodeData.properties),(n=g.nodeData.properties)!=null&&n.headers&&(t.headers=Object.entries(g.nodeData.properties.headers).map(([d,x])=>({key:d,value:x}))),((e=g.nodeData.properties)==null?void 0:e.contentType)==="FORM"&&((p=g.nodeData.properties)!=null&&p.body))try{const d=JSON.parse(g.nodeData.properties.body);t.formBody=Object.entries(d).map(([x,h])=>({key:x,value:String(h)}))}catch{t.formBody=[]}else t.bodyJson=((u=g.nodeData.properties)==null?void 0:u.body)||"";c&&t.contentType==="JSON"&&c.setValue(t.bodyJson||"")}return fe(()=>{te()}),L({cancelFunc:D,clickFormSubmit:ee}),(n,e)=>{const p=m("t-input"),u=m("t-form-item"),d=m("t-option"),x=m("t-select"),h=m("t-divider"),T=m("t-icon"),w=m("t-input-group"),N=m("t-empty"),oe=m("t-switch"),q=m("t-popup"),ae=m("t-input-number"),ne=m("t-textarea"),re=m("t-form"),B=m("t-tab-panel"),de=m("t-alert"),se=m("t-radio"),ue=m("t-tabs");return s(),f("div",be,[l(ue,{modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=o=>P.value=o),onChange:j},{default:a(()=>[l(B,{value:1,"destroy-on-hide":!1},{label:a(()=>[...e[13]||(e[13]=[y(" 配置 ",-1)])]),default:a(()=>[e[26]||(e[26]=v("br",null,null,-1)),l(re,{ref_key:"form",ref:J,rules:M,data:t,colon:!0,onReset:D,onSubmit:le},{default:a(()=>[l(u,{label:"名称",name:"name"},{default:a(()=>[l(p,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),readonly:r.value,placeholder:"请输入节点名称"},null,8,["modelValue","readonly"])]),_:1}),l(u,{label:"数据源",name:"datasourceCode"},{default:a(()=>[l(x,{modelValue:t.datasourceCode,"onUpdate:modelValue":e[1]||(e[1]=o=>t.datasourceCode=o),readonly:r.value,filterable:"",placeholder:"请选择数据源",style:{width:"100%"}},{default:a(()=>[(s(!0),f(U,null,C(H.value,o=>(s(),k(d,{key:o.code,value:o.code,label:o.name,onClick:S=>t.datasourceName=o.name},{default:a(()=>[y(xe(o.name),1)]),_:2},1032,["value","label","onClick"]))),128))]),_:1},8,["modelValue","readonly"])]),_:1}),l(h,null,{default:a(()=>[...e[14]||(e[14]=[y("请求方式",-1)])]),_:1}),l(u,{label:"请求方法",name:"method"},{default:a(()=>[l(x,{modelValue:t.method,"onUpdate:modelValue":e[2]||(e[2]=o=>t.method=o),readonly:r.value,placeholder:"请选择"},{default:a(()=>[l(d,{value:"GET",label:"GET"}),l(d,{value:"POST",label:"POST"})]),_:1},8,["modelValue","readonly"])]),_:1}),l(u,{label:"内容类型",name:"contentType"},{default:a(()=>[l(x,{modelValue:t.contentType,"onUpdate:modelValue":e[3]||(e[3]=o=>t.contentType=o),readonly:r.value,placeholder:"请选择"},{default:a(()=>[l(d,{value:"JSON",label:"请求体(application/json)"}),l(d,{value:"FORM",label:"表单(application/x-www-form-urlencoded)"})]),_:1},8,["modelValue","readonly"])]),_:1}),l(h,null,{default:a(()=>[...e[15]||(e[15]=[y("请求头",-1)])]),_:1}),v("div",Ve,[(s(!0),f(U,null,C(t.headers,(o,S)=>(s(),k(w,{key:S,separate:"",style:{"margin-bottom":"5px"}},{default:a(()=>[l(p,{modelValue:o.key,"onUpdate:modelValue":i=>o.key=i,readonly:r.value,placeholder:"名称",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue","readonly"]),e[17]||(e[17]=v("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}},"  -  ",-1)),l(p,{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,readonly:r.value,placeholder:"值/表达式",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue","readonly"]),r.value?b("",!0):(s(),f("div",ge,[e[16]||(e[16]=y("   ",-1)),l(T,{loadDefaultIcons:!1,style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle",onClick:i=>$(S)},null,8,["onClick"])]))]),_:2},1024))),128)),t.headers.length===0&&V.type==="publish"?(s(),k(N,{key:0})):b("",!0),r.value?b("",!0):(s(),f("div",{key:1,onClick:G,style:{border:"1px dashed var(--td-text-color-placeholder)",height:"25px",color:"var(--td-text-color-secondary)","border-radius":"4px",cursor:"pointer",width:"80%",margin:"10px auto"}},[l(T,{loadDefaultIcons:!1,name:"add-circle"})]))]),l(h,null,{default:a(()=>[...e[18]||(e[18]=[y("请求参数",-1)])]),_:1}),t.contentType==="JSON"?(s(),k(u,{key:0,labelWidth:0,name:"bodyJson"},{default:a(()=>[v("div",{ref_key:"editorContainer",ref:_,style:{height:"150px",width:"100%"}},null,512)]),_:1})):t.contentType==="FORM"?(s(),f("div",he,[(s(!0),f(U,null,C(t.formBody,(o,S)=>(s(),k(w,{key:S,separate:"",style:{"margin-bottom":"5px"}},{default:a(()=>[l(p,{modelValue:o.key,"onUpdate:modelValue":i=>o.key=i,readonly:r.value,placeholder:"属性",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue","readonly"]),e[20]||(e[20]=v("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}},"  -  ",-1)),l(p,{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,readonly:r.value,placeholder:"值/表达式",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue","readonly"]),r.value?b("",!0):(s(),f("div",ke,[e[19]||(e[19]=y("   ",-1)),l(T,{loadDefaultIcons:!1,style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle",onClick:i=>X(S)},null,8,["onClick"])]))]),_:2},1024))),128)),t.formBody.length===0&&V.type==="publish"?(s(),k(N,{key:0})):b("",!0),r.value?b("",!0):(s(),f("div",{key:1,onClick:A,style:{border:"1px dashed var(--td-text-color-placeholder)",height:"25px",color:"var(--td-text-color-secondary)","border-radius":"4px",cursor:"pointer",width:"80%",margin:"10px auto","text-align":"center","line-height":"25px"}},[l(T,{loadDefaultIcons:!1,name:"add-circle"})]))])):b("",!0),l(h,null,{default:a(()=>[...e[21]||(e[21]=[y("响应状态判断",-1)])]),_:1}),l(u,{label:"类型",name:"statusExpression.type"},{default:a(()=>[l(x,{modelValue:t.statusExpression.type,"onUpdate:modelValue":e[4]||(e[4]=o=>t.statusExpression.type=o),readonly:r.value},{default:a(()=>[l(d,{value:"JSONPATH",label:"路径"}),l(d,{value:"EXPRESSION",label:"表达式"})]),_:1},8,["modelValue","readonly"])]),_:1}),l(u,{label:"表达式",name:"statusExpression.expression"},{default:a(()=>[l(p,{modelValue:t.statusExpression.expression,"onUpdate:modelValue":e[5]||(e[5]=o=>t.statusExpression.expression=o),readonly:r.value,placeholder:"请输入表达式"},null,8,["modelValue","readonly"])]),_:1}),l(u,{label:"比较值",name:"successStatus"},{default:a(()=>[l(p,{modelValue:t.successStatus,"onUpdate:modelValue":e[6]||(e[6]=o=>t.successStatus=o),readonly:r.value,placeholder:"请输入成功状态值"},null,8,["modelValue","readonly"])]),_:1}),l(h,null,{default:a(()=>[...e[22]||(e[22]=[y("数据提取",-1)])]),_:1}),l(u,{label:"类型",name:"recordExpression.type"},{default:a(()=>[l(x,{modelValue:t.recordExpression.type,"onUpdate:modelValue":e[7]||(e[7]=o=>t.recordExpression.type=o),readonly:r.value},{default:a(()=>[l(d,{value:"JSONPATH",label:"路径"}),l(d,{value:"EXPRESSION",label:"表达式"})]),_:1},8,["modelValue","readonly"])]),_:1}),l(u,{label:"表达式",name:"recordExpression.expression",help:"允许不提取记录，当仅提取参数发送给下游节点时使用。"},{default:a(()=>[l(p,{modelValue:t.recordExpression.expression,"onUpdate:modelValue":e[8]||(e[8]=o=>t.recordExpression.expression=o),readonly:r.value,placeholder:"请输入表达式"},null,8,["modelValue","readonly"])]),_:1}),l(h,null,{default:a(()=>[...e[23]||(e[23]=[y("循环调用配置",-1)])]),_:1}),l(u,{label:"启用循环",name:"loopPull"},{default:a(()=>[l(oe,{modelValue:t.loopPull,"onUpdate:modelValue":e[9]||(e[9]=o=>t.loopPull=o),disabled:r.value},null,8,["modelValue","disabled"]),e[24]||(e[24]=y("   ",-1)),l(q,{content:"循环调用接口获取数据，直到没有数据返回或者数据未发生变化时停止"},{default:a(()=>[l(T,{loadDefaultIcons:!1,name:"help-circle"})]),_:1})]),_:1}),t.loopPull?(s(),k(u,{key:2,label:"最大循环",name:"maxLoopCount"},{default:a(()=>[l(ae,{modelValue:t.maxLoopCount,"onUpdate:modelValue":e[10]||(e[10]=o=>t.maxLoopCount=o),readonly:r.value,min:1,max:1e4,style:{width:"150px"}},null,8,["modelValue","readonly"])]),_:1})):b("",!0),l(h,null,{default:a(()=>[...e[25]||(e[25]=[y("其他配置",-1)])]),_:1}),l(u,{label:"描述",name:"description"},{default:a(()=>[l(ne,{modelValue:t.description,"onUpdate:modelValue":e[11]||(e[11]=o=>t.description=o),readonly:r.value,rows:4},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["data"])]),_:1}),l(B,{value:2,"destroy-on-hide":!1},{label:a(()=>[...e[27]||(e[27]=[y(" 参数提取 ",-1)])]),default:a(()=>[e[34]||(e[34]=v("br",null,null,-1)),l(de,{theme:"info",style:{"margin-top":"-10px","margin-bottom":"8px"}},{message:a(()=>[...e[28]||(e[28]=[y(" 提取参数作为下次循环请求的请求头、入参中使用。或把参数提取给下游使用。 ",-1)])]),_:1}),v("div",Se,[(s(!0),f(U,null,C(t.variables,(o,S)=>(s(),k(w,{separate:"",style:{"margin-bottom":"5px","margin-top":"5px"}},{default:a(()=>[v("div",Te,[l(q,{content:"是否必须提取到该变量，如果是必须时提取不到则中断流程"},{default:a(()=>[l(se,{allowUncheck:"",modelValue:o.required,"onUpdate:modelValue":i=>o.required=i,disabled:V.type==="publish"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),e[30]||(e[30]=y("   ",-1)),l(x,{placeholder:"变量类型",modelValue:o.variableType,"onUpdate:modelValue":i=>o.variableType=i,readonly:V.type==="publish",style:{width:"98px"}},{default:a(()=>[l(d,{value:"l",label:"循环变量"}),l(d,{value:"t",label:"传输变量"})]),_:1},8,["modelValue","onUpdate:modelValue","readonly"]),e[31]||(e[31]=v("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}}," -  ",-1)),l(x,{placeholder:"表达式类型",modelValue:o.expressionType,"onUpdate:modelValue":i=>o.expressionType=i,readonly:V.type==="publish",style:{width:"98px"}},{default:a(()=>[l(d,{value:"JSONPATH",label:"路径"}),l(d,{value:"EXPRESSION",label:"表达式"})]),_:1},8,["modelValue","onUpdate:modelValue","readonly"]),e[32]||(e[32]=v("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}}," -  ",-1)),l(p,{modelValue:o.key,"onUpdate:modelValue":i=>o.key=i,style:{width:"98px","margin-left":"2px"},readonly:V.type==="publish",placeholder:"属性"},null,8,["modelValue","onUpdate:modelValue","readonly"]),e[33]||(e[33]=v("div",{style:{lineHeight:"32px",height:"32px",color:"var(--td-text-color-secondary)"}}," -  ",-1)),l(p,{modelValue:o.expression,"onUpdate:modelValue":i=>o.expression=i,style:{width:"164px","margin-left":"2px"},readonly:V.type==="publish",placeholder:"表达式"},null,8,["modelValue","onUpdate:modelValue","readonly"]),V.type!=="publish"?(s(),f("div",Oe,[e[29]||(e[29]=y("   ",-1)),l(T,{loadDefaultIcons:!1,onClick:i=>K(S),style:{color:"var(--td-text-color-secondary)",cursor:"pointer"},name:"minus-circle"},null,8,["onClick"])])):b("",!0)]),_:2},1024))),256)),t.variables.length===0&&V.type==="publish"?(s(),k(N,{key:0,title:"未配置参数提取"})):b("",!0),r.value?b("",!0):(s(),f("div",{key:1,onClick:W,style:{border:"1px dashed var(--td-text-color-placeholder)",height:"25px",color:"var(--td-text-color-secondary)","border-radius":"4px",cursor:"pointer",width:"80%",margin:"10px auto","font-size":"12px","text-align":"center","line-height":"25px"}},[l(T,{loadDefaultIcons:!1,name:"add-circle",style:{"font-size":"14px"}})]))])]),_:1})]),_:1},8,["modelValue"])])}}}),we=ve(_e,[["__scopeId","data-v-f0662d13"]]);export{we as default};
