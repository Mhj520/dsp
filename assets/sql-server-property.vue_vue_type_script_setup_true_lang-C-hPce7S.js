import{l as le,g as ae}from"./source-C6q21X3i.js";import{d as oe,db as ne,r as b,L as re,N as y,v as ue,a as u,c as E,o as p,b as o,u as a,w as n,f as V,x as D,F as K,y as P,h as _,t as j,e as v}from"./index-DsliLC_t.js";import{e as w}from"./toggleHighContrast-BzokclBc.js";const se={key:2},ce=oe({__name:"sql-server-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(m,{expose:z,emit:A}){const h=m,N=A;let t=ne({name:"SQLServer数据写入",description:"",datasourceCode:null,datasourceName:null,schemaCode:null,schemaName:null,tableCode:null,primaryKey:[],customSQL:{enable:!1,mapping:{DELETE:"",UPDATE:"",INSERT:""}}});const I={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0,message:"数据源必选"}],schemaCode:[{required:!0,message:"数据库必选"}],tableCode:[{required:!0,message:"表必选"}],primaryKey:[{required:!0,message:"主键列必填"}]},$=()=>{h.lf.setProperties(h.nodeData.id,{...t})},G=r=>{r.validateResult===!0&&($(),N("closed"))},Q=b(null);function H(){Q.value.submit()}const x=()=>{N("closed")},T=b([]),U=b([]);function q(r){t.datasourceName=r.name,le({id:r.id}).then(e=>{e&&(U.value=e,e.forEach(c=>{if(h.nodeData.properties.schemaCode===c.key){O(c);return}}))})}function O(r){t.schemaName=r.label}async function J(){await ae({query:{type:"SQLServer",status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(r=>{if(r){const{records:e}=r;T.value=e,e.forEach(c=>{if(h.nodeData.properties.datasourceCode===c.code){q(c);return}})}}),Object.assign(t,h.nodeData.properties)}const g=b(null),C=b(null),S=b(null);let s,d,i;const L=()=>{g.value&&!s&&(s=w.create(g.value,{value:t.customSQL.mapping.DELETE,language:"sql",theme:y(),placeholder:"delete from schema.table where id = :id",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),s.onDidChangeModelContent(()=>{t.customSQL.mapping.DELETE=s.getValue()})),C.value&&!d&&(d=w.create(C.value,{value:t.customSQL.mapping.UPDATE,language:"sql",theme:y(),placeholder:"update schema.table set name = 'test' where id = :id",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),d.onDidChangeModelContent(()=>{t.customSQL.mapping.UPDATE=d.getValue()})),S.value&&!i&&(i=w.create(S.value,{value:t.customSQL.mapping.INSERT,language:"sql",theme:y(),placeholder:"insert into schema.table (id, name) values (:id, :name)",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),i.onDidChangeModelContent(()=>{t.customSQL.mapping.INSERT=i.getValue()}))};return re(()=>{if(g.value){L();const r=y();s&&s.updateOptions({theme:r})}else s&&(s.dispose(),s=null);if(C.value){L();const r=y();d&&d.updateOptions({theme:r})}else d&&(d.dispose(),d=null);if(S.value){L();const r=y();i&&i.updateOptions({theme:r})}else i&&(i.dispose(),i=null)}),ue(()=>{J()}),z({cancelFunc:x,clickFormSubmit:H}),(r,e)=>{const c=u("t-input"),f=u("t-form-item"),F=u("t-option"),R=u("t-select"),W=u("t-tag-input"),X=u("t-switch"),M=u("t-divider"),k=u("t-tab-panel"),Y=u("t-tabs"),Z=u("t-textarea"),ee=u("t-form");return p(),E("div",null,[o(ee,{ref_key:"form",ref:Q,rules:I,data:a(t),colon:!0,onReset:x,onSubmit:G},{default:n(()=>{var B;return[o(f,{label:"名称",name:"name"},{default:n(()=>[o(c,{modelValue:a(t).name,"onUpdate:modelValue":e[0]||(e[0]=l=>a(t).name=l),readonly:m.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),o(f,{label:"数据源",name:"datasourceCode"},{default:n(()=>[o(R,{filterable:"",modelValue:a(t).datasourceCode,"onUpdate:modelValue":e[1]||(e[1]=l=>a(t).datasourceCode=l),readonly:m.type==="publish",onChange:e[2]||(e[2]=()=>{a(t).schemaCode=null,a(t).schemaName=null,a(t).tableCode=null}),placeholder:"请选择数据源",style:{width:"100%"}},{default:n(()=>[(p(!0),E(K,null,P(T.value,l=>(p(),V(F,{value:l.code,onClick:te=>q(l),label:l.name},{default:n(()=>[_(j(l.name),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1}),a(t).datasourceCode?(p(),V(f,{key:0,label:"库",name:"schemaCode"},{default:n(()=>[o(R,{modelValue:a(t).schemaCode,"onUpdate:modelValue":e[3]||(e[3]=l=>a(t).schemaCode=l),readonly:m.type==="publish",placeholder:"请选择数据库",style:{width:"100%"}},{default:n(()=>[(p(!0),E(K,null,P(U.value,l=>(p(),V(F,{value:l.key,onClick:te=>O(l),label:l.label},{default:n(()=>[_(j(l.label),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1})):D("",!0),a(t).schemaCode?(p(),V(f,{key:1,label:"表",name:"tableCode"},{default:n(()=>[o(c,{modelValue:a(t).tableCode,"onUpdate:modelValue":e[4]||(e[4]=l=>a(t).tableCode=l),readonly:m.type==="publish",placeholder:"请输入写入的表，支持分表"},null,8,["modelValue","readonly"])]),_:1})):D("",!0),o(f,{label:"主键列",name:"primaryKey"},{default:n(()=>[o(W,{modelValue:a(t).primaryKey,"onUpdate:modelValue":e[5]||(e[5]=l=>a(t).primaryKey=l),readonly:m.type==="publish","excess-tags-display-type":"break-line",placeholder:"请输入主键列，回车确认",clearable:""},null,8,["modelValue","readonly"])]),_:1}),o(f,{label:"自定义脚本",name:"customSQL"},{default:n(()=>[o(X,{modelValue:a(t).customSQL.enable,"onUpdate:modelValue":e[6]||(e[6]=l=>a(t).customSQL.enable=l),"before-change":()=>m.type!=="publish"},null,8,["modelValue","before-change"])]),_:1}),(B=a(t).customSQL)!=null&&B.enable?(p(),E("div",se,[o(M,null,{default:n(()=>[...e[8]||(e[8]=[_("自定义脚本",-1)])]),_:1}),o(Y,{"default-value":1},{default:n(()=>[o(k,{value:1,label:"删除"},{default:n(()=>[e[9]||(e[9]=v("br",null,null,-1)),v("div",{ref_key:"deleteEditorContainer",ref:g,style:{height:"150px",width:"100%"}},null,512)]),_:1}),o(k,{value:2,label:"更新"},{default:n(()=>[e[10]||(e[10]=v("br",null,null,-1)),v("div",{ref_key:"updateEditorContainer",ref:C,style:{height:"150px",width:"100%"}},null,512)]),_:1}),o(k,{value:3,label:"插入"},{default:n(()=>[e[11]||(e[11]=v("br",null,null,-1)),v("div",{ref_key:"insertEditorContainer",ref:S,style:{height:"150px",width:"100%"}},null,512)]),_:1})]),_:1})])):D("",!0),o(M,null,{default:n(()=>[...e[12]||(e[12]=[_("其他配置",-1)])]),_:1}),o(f,{label:"描述",prop:"description"},{default:n(()=>[o(Z,{modelValue:a(t).description,"onUpdate:modelValue":e[7]||(e[7]=l=>a(t).description=l),readonly:m.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]}),_:1},8,["data"])])}}});export{ce as _};
