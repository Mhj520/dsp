import{l as ae,g as le}from"./source-C6q21X3i.js";import{d as oe,db as ne,r as b,L as re,N as y,v as ue,a as u,c as S,o as c,b as o,u as l,w as n,f as V,x as D,F as K,y as P,h as _,t as j,e as h}from"./index-DsliLC_t.js";import{e as w}from"./toggleHighContrast-BzokclBc.js";const se={key:2},pe=oe({__name:"sap-hana-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(m,{expose:z,emit:A}){const g=m,N=A;let t=ne({name:"SapHana数据写入",description:"",datasourceCode:null,datasourceName:null,schemaCode:null,schemaName:null,tableCode:null,primaryKey:[],customSQL:{enable:!1,mapping:{DELETE:"",UPDATE:"",INSERT:""}}});const I={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0,message:"数据源必选"}],schemaCode:[{required:!0,message:"数据库必选"}],tableCode:[{required:!0,message:"表必选"}],primaryKey:[{required:!0,message:"主键列必填"}]},H=()=>{g.lf.setProperties(g.nodeData.id,{...t})},$=r=>{r.validateResult===!0&&(H(),N("closed"))},x=b(null);function G(){x.value.submit()}const T=()=>{N("closed")},Q=b([]),U=b([]);function q(r){t.datasourceName=r.name,ae({id:r.id}).then(e=>{e&&(U.value=e,e.forEach(p=>{if(g.nodeData.properties.schemaCode===p.key){O(p);return}}))})}function O(r){t.schemaName=r.label}async function J(){await le({query:{type:"SapHana",status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(r=>{if(r){const{records:e}=r;Q.value=e,e.forEach(p=>{if(g.nodeData.properties.datasourceCode===p.code){q(p);return}})}}),Object.assign(t,g.nodeData.properties)}const v=b(null),C=b(null),E=b(null);let s,d,i;const L=()=>{v.value&&!s&&(s=w.create(v.value,{value:t.customSQL.mapping.DELETE,language:"sql",theme:y(),placeholder:"delete from schema.table where id = :id",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),s.onDidChangeModelContent(()=>{t.customSQL.mapping.DELETE=s.getValue()})),C.value&&!d&&(d=w.create(C.value,{value:t.customSQL.mapping.UPDATE,language:"sql",theme:y(),placeholder:"update schema.table set name = 'test' where id = :id",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),d.onDidChangeModelContent(()=>{t.customSQL.mapping.UPDATE=d.getValue()})),E.value&&!i&&(i=w.create(E.value,{value:t.customSQL.mapping.INSERT,language:"sql",theme:y(),placeholder:"insert into schema.table (id, name) values (:id, :name)",minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),i.onDidChangeModelContent(()=>{t.customSQL.mapping.INSERT=i.getValue()}))};return re(()=>{if(v.value){L();const r=y();s&&s.updateOptions({theme:r})}else s&&(s.dispose(),s=null);if(C.value){L();const r=y();d&&d.updateOptions({theme:r})}else d&&(d.dispose(),d=null);if(E.value){L();const r=y();i&&i.updateOptions({theme:r})}else i&&(i.dispose(),i=null)}),ue(()=>{J()}),z({cancelFunc:T,clickFormSubmit:G}),(r,e)=>{const p=u("t-input"),f=u("t-form-item"),F=u("t-option"),R=u("t-select"),W=u("t-tag-input"),X=u("t-switch"),M=u("t-divider"),k=u("t-tab-panel"),Y=u("t-tabs"),Z=u("t-textarea"),ee=u("t-form");return c(),S("div",null,[o(ee,{ref_key:"form",ref:x,rules:I,data:l(t),colon:!0,onReset:T,onSubmit:$},{default:n(()=>{var B;return[o(f,{label:"名称",name:"name"},{default:n(()=>[o(p,{modelValue:l(t).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(t).name=a),readonly:m.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),o(f,{label:"数据源",name:"datasourceCode"},{default:n(()=>[o(R,{filterable:"",modelValue:l(t).datasourceCode,"onUpdate:modelValue":e[1]||(e[1]=a=>l(t).datasourceCode=a),readonly:m.type==="publish",onChange:e[2]||(e[2]=()=>{l(t).schemaCode=null,l(t).schemaName=null,l(t).tableCode=null}),placeholder:"请选择数据源",style:{width:"100%"}},{default:n(()=>[(c(!0),S(K,null,P(Q.value,a=>(c(),V(F,{value:a.code,onClick:te=>q(a),label:a.name},{default:n(()=>[_(j(a.name),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1}),l(t).datasourceCode?(c(),V(f,{key:0,label:"库",name:"schemaCode"},{default:n(()=>[o(R,{modelValue:l(t).schemaCode,"onUpdate:modelValue":e[3]||(e[3]=a=>l(t).schemaCode=a),readonly:m.type==="publish",placeholder:"请选择数据库",style:{width:"100%"}},{default:n(()=>[(c(!0),S(K,null,P(U.value,a=>(c(),V(F,{value:a.key,onClick:te=>O(a),label:a.label},{default:n(()=>[_(j(a.label),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["modelValue","readonly"])]),_:1})):D("",!0),l(t).schemaCode?(c(),V(f,{key:1,label:"表",name:"tableCode"},{default:n(()=>[o(p,{modelValue:l(t).tableCode,"onUpdate:modelValue":e[4]||(e[4]=a=>l(t).tableCode=a),readonly:m.type==="publish",placeholder:"请输入写入的表，支持分表"},null,8,["modelValue","readonly"])]),_:1})):D("",!0),o(f,{label:"主键列",name:"primaryKey"},{default:n(()=>[o(W,{modelValue:l(t).primaryKey,"onUpdate:modelValue":e[5]||(e[5]=a=>l(t).primaryKey=a),readonly:m.type==="publish","excess-tags-display-type":"break-line",placeholder:"请输入主键列，回车确认",clearable:""},null,8,["modelValue","readonly"])]),_:1}),o(f,{label:"自定义脚本",name:"customSQL"},{default:n(()=>[o(X,{modelValue:l(t).customSQL.enable,"onUpdate:modelValue":e[6]||(e[6]=a=>l(t).customSQL.enable=a),"before-change":()=>m.type!=="publish"},null,8,["modelValue","before-change"])]),_:1}),(B=l(t).customSQL)!=null&&B.enable?(c(),S("div",se,[o(M,null,{default:n(()=>[...e[8]||(e[8]=[_("自定义脚本",-1)])]),_:1}),o(Y,{"default-value":1},{default:n(()=>[o(k,{value:1,label:"删除"},{default:n(()=>[e[9]||(e[9]=h("br",null,null,-1)),h("div",{ref_key:"deleteEditorContainer",ref:v,style:{height:"150px",width:"100%"}},null,512)]),_:1}),o(k,{value:2,label:"更新"},{default:n(()=>[e[10]||(e[10]=h("br",null,null,-1)),h("div",{ref_key:"updateEditorContainer",ref:C,style:{height:"150px",width:"100%"}},null,512)]),_:1}),o(k,{value:3,label:"插入"},{default:n(()=>[e[11]||(e[11]=h("br",null,null,-1)),h("div",{ref_key:"insertEditorContainer",ref:E,style:{height:"150px",width:"100%"}},null,512)]),_:1})]),_:1})])):D("",!0),o(M,null,{default:n(()=>[...e[12]||(e[12]=[_("其他配置",-1)])]),_:1}),o(f,{label:"描述",prop:"description"},{default:n(()=>[o(Z,{modelValue:l(t).description,"onUpdate:modelValue":e[7]||(e[7]=a=>l(t).description=a),readonly:m.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]}),_:1},8,["data"])])}}});export{pe as _};
