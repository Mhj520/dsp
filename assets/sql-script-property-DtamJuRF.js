import{e as R}from"./toggleHighContrast-BzokclBc.js";import{g as j}from"./source-C6q21X3i.js";import{d as P,db as Q,r as c,L as U,N as C,v as z,a as s,c as x,o as f,b as a,u as r,w as n,F as H,y as $,f as A,h as _,t as I,e as W,i as G}from"./index-DsliLC_t.js";const J=P({__name:"sql-script-property",props:{nodeData:Object,lf:Object||String,flowDetail:{type:Object,default:()=>({})},type:{type:String}},setup(d,{expose:V,emit:h}){const p=d,y=h;let e=Q({name:"SQL脚本",description:"",scriptText:"",datasourceCode:void 0,datasourceName:void 0});const L={name:[{required:!0,message:"名称必填"}],datasourceCode:[{required:!0,message:"数据源必填"}],scriptText:[{required:!0,message:"脚本语句必填"}]},m=c(null);let l;const k=c("");U(()=>{m.value?(w(),l.updateOptions({theme:C()})):l&&l.dispose()});function w(){l||(l=R.create(m.value,{value:k.value,placeholder:"select/update/delete",language:"sql",theme:C(),codeLens:!1,folding:!0,snippetSuggestions:"inline",tabCompletion:"on",foldingStrategy:"auto",smoothScrolling:!0,minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:4},automaticLayout:!0}),l.onDidChangeModelContent(()=>{e.scriptText=l.getValue()}))}const D=()=>{p.lf.setProperties(p.nodeData.id,{...e})},q=i=>{i.validateResult===!0&&(D(),y("closed"))},g=c(null);function F(){g.value.submit()}const b=()=>{y("closed")},v=c([]);async function N(){await j({query:{types:["MySQL","Doris","Oracle","StarRocks","PostgreSQL","Dameng","ClickHouse","SQLServer","SapHana"],status:"ENABLE"},page:{current:1,size:9999},orders:[]}).then(i=>{if(i){const{records:t}=i;v.value=t}}),Object.assign(e,p.nodeData.properties),l.setValue(e.scriptText)}return z(()=>{N()}),V({cancelFunc:b,clickFormSubmit:F}),(i,t)=>{const O=s("t-input"),u=s("t-form-item"),T=s("t-option"),E=s("t-select"),S=s("t-divider"),B=s("t-textarea"),M=s("t-form");return f(),x("div",null,[a(M,{ref_key:"form",ref:g,rules:L,data:r(e),colon:!0,onReset:b,onSubmit:q},{default:n(()=>[a(u,{label:"名称",name:"name"},{default:n(()=>[a(O,{modelValue:r(e).name,"onUpdate:modelValue":t[0]||(t[0]=o=>r(e).name=o),readonly:d.type==="publish",placeholder:"请输入内容"},null,8,["modelValue","readonly"])]),_:1}),a(u,{label:"数据源",name:"datasourceCode"},{default:n(()=>[a(E,{readonly:d.type==="publish",filterable:"",modelValue:r(e).datasourceCode,"onUpdate:modelValue":t[1]||(t[1]=o=>r(e).datasourceCode=o),placeholder:"请选择数据源",style:{width:"100%"}},{default:n(()=>[(f(!0),x(H,null,$(v.value,o=>(f(),A(T,{value:o.code,onClick:K=>r(e).datasourceName=o.name,label:o.name},{default:n(()=>[_(I(o.name),1)]),_:2},1032,["value","onClick","label"]))),256))]),_:1},8,["readonly","modelValue"])]),_:1}),a(S,null,{default:n(()=>[...t[3]||(t[3]=[_("执行语句",-1)])]),_:1}),a(u,{name:"scriptText",labelWidth:0},{default:n(()=>[W("div",{ref_key:"editorContainer",ref:m,style:{height:"400px",width:"100%"}},null,512)]),_:1}),a(S,null,{default:n(()=>[...t[4]||(t[4]=[_("其他配置",-1)])]),_:1}),a(u,{label:"描述",prop:"description"},{default:n(()=>[a(B,{modelValue:r(e).description,"onUpdate:modelValue":t[2]||(t[2]=o=>r(e).description=o),readonly:d.type==="publish",rows:4},null,8,["modelValue","readonly"])]),_:1})]),_:1},8,["data"])])}}}),ee=G(J,[["__scopeId","data-v-676132c7"]]);export{ee as default};
